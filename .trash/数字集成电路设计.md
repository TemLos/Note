---
title: 数字集成电路设计
date: 2023-09-26 18:13
mdate: 2023-10-14 20:07:59
tags:
  - Note
  - Hardware
  - Circuit
---
# Lecture 0 Intro
- Planar FET
    ![|475](image_29.jpg)
- FinFET
    ![|271](image_30.jpg)
- GAA FET
    ![|256](image_31.jpg)
- FDSOI
    Fully Depleted Silicon on Insulator.<https://www.bilibili.com/video/BV1M5411Q7zo/?spm_id_from=333.337.search-card.all.click&vd_source=dc4674766076b0c1c7b843aed68f8625>.
    
- Study trend
    - Thermal Issue
    - Variations
        Spatial varation & Temporal varation
    - 3D Integration
        Higher packing density,faster **on-chip** communication, but higher power density.
    - 2.5D Chiplets
    ![|575](image_32.jpg)
        - Low fabrication costs
        - different source, more flexible
        - can’ t improve intergration
      - Security
          IP protection
      - AI Chips
      - Open Source RISC-V
# Lectrue 1 Transister
![|550](image_33.jpg)
Current of PN junction flows only in one direction
#### BJT
![|575](image_34.jpg)
$n^{++}$:Heavy Dopant
$V_{CE}$:make electrons arrive deplete region
$V_{CB}$:make electrons cross deplete region
- Base currents of BJT limit its integration desity. 

#### MOSFET
![|575](image_35.jpg)
- **Conductor of polysilicon is between metal and semiconductor?**
- FinFET begin to be used at 22nm node.
- Compared with BJT, low power characteristic of MOSFET allows very high integration
![|575](image_36.jpg)
- The body terminal is at low voltage to avoid PN junction breakovering.
- The gate terminal is at low voltage
    - No current flows, the transistor is OFF
- The gate terminal is at a high voltage
    - **Negative** charge attracted to surface and invert a channel under gate to **n-type**
    - **P-type** bulk silicon provides **minor carriers** to build invert channel.
    - Ideally, $I_GB=0$, but it’ s hard to achieve in fact, because of thin and impure insulator.
**Why pursue thiner insulator?**
$SiO_2$ is a plate capacity, the lower thickness, the more carriers, and the more carriers, the greater or faster current.
![](image_37.jpg)
p+Substrate Tap and n+Well Tap are used to set bulk voltage.
#### Threshold Voltage
With large enough bias, enough electrons will be pulled to “inverted” the surface(p->n-type)
**How to calculate threshold voltage**
$$
V_{T0}=V_{FB}+\varphi_s+\frac{Q_d}{C_{ox}}+\frac{Q_{ox}}{C_{ox}}
$$
$$
V_T=V_{T0}+\gamma\cdot(\sqrt{\varphi_s+V_{SB}}-\sqrt{\varphi_s})
$$
To control threshold voltage, we have to insulate P and N substrate.
![[image_58.jpeg|500]]

#### Static behavior
![[image_59.jpeg|500]]
- Cutoff Region
![[image_60.jpeg|500]]
- Linear Region
![[image_61.jpeg|500]]
In Linear region, $I_{ds}$ depends on concentration and velocity of the charge in the channel.($I=\frac{Q}{t}$) 
Firstly, we calculate Q
$$
Q_{channel}=C\cdot V
$$
Notice that there are two capacity in Linear region——depletion capacity and SiO2 capacity. We use SiO2 capacity.
$$
C=C_g=\frac{\epsilon_{ox}}{t_{ox}}\cdot WL=C_{ox}\cdot WL
$$
![[image_62.jpeg]]
Then we calculate t.
$$
\begin{cases}
E&=\frac{V_{ds}}{L}\\
v&=\mu\cdot E\\
t&=\frac{L}{v}
\end{cases}
$$
So we have
$$
\begin{align}
I_{ds}&=\frac{Q_{channel}}{t}\\
&=\mu C_{ox}\frac{W}{L}(V_{gs}-V_T-\frac{V_{ds}}{2})V_{ds}\\
&=\beta(V_{gs}-V_T-\frac{V_{ds}}{2})V_{ds}\\
\beta&=\mu C_{ox}\frac{W}{L}
\end{align}
$$
we can get maximum of $I_{ds}$ when $V_{ds}=V_{gs}-V_T$ . If we use calculus method, we’ll get the same current formula.
- Saturation
![[image_63.jpeg|550]]
If keep increasing $V_{ds}$ when cuts off:
$V_{ds}$ broadens cutoff region and voltage at cutoff point is equal to $V_{gs}$ .

**How to get R when in saturation region**
![|525](image_64.jpeg)
![|525](image_65.jpeg)
#### Dynamic behavior
- Delay
![[image_66.jpeg|500]]

**Why is $\frac{t_{HL}+t_{LH}}{2}$?**
Not true value table, but engineer consideration——don’t know customer’s usage, so take them equal.
**Why is 90% or 10%?**
1. If higher than 90%: too slow
2. If lower than 90%: too obvious noice

#### MOS capacity
###### Gate Capacity
![|450](image_67.jpeg)
- Cutoff region
![|450](image_68.jpeg)
Capacitance becomes series combination of gate oxide and deletion capacitance.
- Linear region
![|450](image_69.jpeg)
Channel makes $C_{GCB}$ drops to zero, we model capacitance by splitting oxide cap equally between source and drain.
- Saturation region
![|525](image_70.jpeg)
At pinch-off point, $V_GC=V_T$**?未完?**, In bottom line, $C_{GCS}=2/3WLC_{ox}$
- Other capacitance
Gate overlap capacitance
$$
C_{GSO}=C_{GDO}=C_{ox}\cdot x_d W
$$
Gate fringe capacitance
###### Diffusion/Junction Capacitance
Junction caps are nonlinear(function of junction bias voltage), to deal with, we have
$$
C_{eq}=\frac{\Delta Q_j}{\Delta V_D}=\frac{Q_j(V_{high})-Q_j(V_{low})}{V_{high}-V_{low}}=K_{eq}C_{j0}
$$
In summary, we have gaga-to-channel capacitance
![|500](image_71.jpeg)
###### Capacitance Model Summery
![|500](image_72.jpeg)
**Is Subthreshold Region the smaller the better?**
- As for high-performance device, the smaller the better.
- As for low-power device, Subthreshold can be taken into design consideration.
#### Non-ideal Transistor Behaviour
###### High Electronic Fields Effects
For long channel device
- Vertical electric field: $E_{vert}=V_{gs}/t_{ox},\quad Q_{channel}\propto E_{vert}$
i- Lateral elecric field: $E_{lat}=V_{ds}/L, \quad v\propto\mu\dot E_{lat}$
###### Mobility Degradation
For short channel device, mobility decreases when vertical electronic fields is too large.
###### Velocity Saturation
For short channel device, because carriers scatter off atoms in silicon lattice, velocity reaches $v_{sat}$ which is :
- Electrons: $10^7cm/s$
- Holes: $8\times 10^6cm/s$
Consider nonlinear velocity model
$$
\begin{cases}
\begin{align}
v_{eff}&=\frac{\mu_{eff}\cdot E}{1+E/E_C},\quad for\ E\le E_C\\
v_{eff}&=v_{sat}=\frac{\mu_{eff}\cdot E_C}{2},\quad for\ E\ge E_C
\end{align}
\end{cases}
$$
By using the formula, we divide four regions of operation:
(1)cut off, (2)linear, **(3)velocity sat**, (4) current sat
So in linear region, we have
$$
I_{DS}=\frac{\mu_{eff}C_{ox}}{1+\frac{V_{DS}}{E_CL}}\cdot \frac{W}{L}\cdot[(V_{GS}-V_t)V_{DS}-\frac{V^2_{DS}}{2}]
$$
In velocity saturation region, consider
$$
I_{D}
=WQ_{inv}(y)v(y)$$
we have
$$
\begin{align}
I_{DSAT}&=v_{sat}\cdot C_{ox}\cdot W\cdot [V_{GS}-V_t-V'_{DSAT}]\\
&=\frac{\mu_{eff}C_{ox}}{1+\frac{V_{DS}}{E_CL}}\cdot \frac{W}{L}\cdot[(V_{GS}-V_t)V’_{DSAT}-]\frac{V^{,2}_{DSAT}}{2}]\\
&=\frac{\mu_{eff}E_c}{2}\cdot C_{ox}\cdot W\cdot[V_{GS}-V_t-V'_{SAT}]
\end{align}
$$
where
$$
V'_{DSAT}=\frac{V_{GS}-V_T}{1+(V_{GS}-V_T)/E_C\cdot L}=K\cdot V_{GT}\lt V_{DSAT}
$$
###### Channel Length Modulation(CLM)
Consider $\Delta L\lt L$
we have 
$$
\frac{1}{L-\Delta L}\approx \frac{1}{L}(1+\frac{\Delta L}{L})=\frac{1}{L}(1+\lambda V_{DS})
$$
$$
\begin{align}
I_{DS}&=\frac{\mu_n C_{ox}}{2}\cdot \frac{W}{L’}(V_{GS}-V_t)^2\\
&=\frac{\mu_n C_{ox}}{2}\cdot \frac{W}{L}(V_{GS}-V_t)^2\cdot (1+\lambda V_{DS})
\end{align}
$$
###### Threshold Voltage Effects
Threshold voltage depends on almost everything:

- Body Effect
$$
V_T=V_{T0}+\gamma\cdot(\sqrt{\varphi_S+V_{SB}}-\sqrt{\varphi_S})
$$
- Short/Narrow Channel Effect
- Drain-Induced Barrier Lowering(DIBL)
		High drain voltage causes current to increase.
$$
V_t’=V_t’-\eta V_{ds}
$$
**How to induce DIBL?**
![](image_73.jpeg)
###### Leakage
![550](image_74.jpeg)

###### Temperature Sensitivity
Current in sub-threshold region
$$
I_{ds}=I_{ds0}\cdot e^{\frac{v_{gs}-V_{t0}+\eta V_{ds}-k_\gamma V_{sb}}{nv_T}(1-e^{(-V_{ds}/v_T)})}
$$
###### Process and Environmental Variations
- Supply voltage
- 

# Lecture 2 Wires
#### Classes of global interconnects
- Global set and reset lines
- System clocks(s)
- Power distribution($V_D$ and GND)

#### The Local Wires

#### Wire Geometry
![](image_75.jpeg)
s: spacing
t: thickness
h: thickness of oxide insulator
w: width
l: length
- Pitch=w+s
- Aspect Ratio: AR=t/w
	Modern AR $\approx$ 2
#### Parasitic Modeling of Interconnect
##### Resistance
- MOS structure resistance - $R_{ON}$
- Source and drain resistance
- Contact (via) resistance
- Wiring resistance
###### Wiring Resistance
$$
R=\rho\frac{L}{A}=\rho\frac{L}{HW}
$$
To make it irrelevant to the designer, we use Sheet Resistance R
![](image_76.jpeg)
**What is Silicide?**
![](image_77.jpeg)
###### Contact Resistance

###### Impact of Wire Resistance
- Power supply
- **As design criteria, Power loss less than 10%?**
#### Capacitance
###### Parallel Plate
$$
C_{pp}=\frac{\varepsilon_{di}}{t_{di}}WL
$$
###### Fringe Capacitance
![](image_78.jpeg)
###### Inter-wire Capacitance
![](image_79.jpeg)

#### Interconnect RC Modeling
###### Elmore Delay
![](image_80.jpeg)
Consider resistance as power driving capacitance(i=5)
- R1 dives C1, C2, C3, C4 ,C5
- R3 drives C3, C4, C5
- R5 drives C5
$$
\begin{align}
\tau = &R_1C_1+R_1C_2+\\
&(R_1+R_3)C_3+\\
&(R_1+R_3)C_4+\\
&(R_1+R_3+R_5)C_5\\
=&R_1(C_1+C_2+C_3+C_4+C_5)+\\
&R_3(C_3+ C_4+C_5)+\\
&R_5C_5
\end{align}
$$

###### The Lumped Model
![](image_81.jpeg)
$$
\Downarrow
$$
![](image_82.jpeg)

$$
\tau = RC
$$
###### The Distributed RC Modeling
![](image_83.jpeg)
Use KCL, we have
$$
\begin{flalign}
&c\Delta L\frac{\partial V_i}{\partial t}=\frac{(V_{i+1}-V_i)+(V_{i-1}-V_i)}{r\Delta L}\\
&\Downarrow\ \Delta L\rightarrow 0\\
&rc\frac{\partial V}{\partial t}=\frac{\partial^2 V}{\partial x^2}
\end{flalign}
$$
$$
\begin{align}
\tau_{DN}&=\sum^N_{l=1}C_l(\sum^l_{j=1}R_j)=\sum^N_{l=1}R_l(\sum^N_{j=l}C_j)\\
&=(\frac{L}{N})^2(rc+2rc+\cdots+Nrc)\\
&=(rcL^2)\frac{N(N+1)}{2N^2}\rightarrow\frac{rcL^2}{2}=\frac{RC}{2}\ (N\rightarrow\infty)\\
&\sim L^2 
\end{align}
$$
_Distributed RC delay is only half of the lumped RC._




# Lecture 3 CMOS Inverter
### Static CMOS Properties
- Full rail-to-rail swing $\Rightarrow$ High noise margin
- Low output impedance $\Rightarrow$ Be able to drive large fan-out
- High input impedance
- No (low) static power dissipation

**How to deign a fast gate**
Consider RC Factor, we can improve swing speed by decreasing resister or capacitance of transistor. 
### Noise
For example, one of  sources of noises: coupling between lines
![](image_84.jpeg)

To see if a gate rejects noise: look at its DC voltage transfer characteristic (VTC)

![](image_85.jpeg)

Define $V_{IH}$ and $V_{IL}$ as the points on the VTC curve where the gain =-1
**Conditions for Regeneration**
![](image_86.jpeg)

### CMOS Inverter VTC
**How to get VTC**
For such inverter circuit
![](image_87.jpeg)
Consider I-V curve of PMOS and NMOS
![](image_88.jpeg)
Transform current and voltage as follows:
$$
I_{dsp}=-I_{dsn}\\
$$
$$
\begin{align}
V_{gsn}=V_{in},\ V_{gsp}=V_{in}-V_{DD}\\
V_{dsn}=V_{out},\ V_{dsp}=V_{out}-V_{DD}
\end{align}
$$
![](image_89.jpeg)
Then draw two curve transformed in one picture
![](image_90.jpeg)
From point of $\{ V_in = 1\ V,\ 1.5\ V,\ \cdots\}$, we can draw VTC
![](image_91.jpeg)

##### Five Operating Regions
![](image_92.jpeg)

- Red line: increasing the width of the PMOS moves $V_M$ towards $V_{DD}$ 
- Blue line: increasing the width of the NMOS moves $V_M$ towards $GND$

![](image_93.jpeg)
Comparing two pictures, it can be find that Inverter can work in sub-threshold region

### Dynamic Properties
**Why are there ”spikes”?**
![](image_18.png)

Consider Miller capacitor from in to out
![](image_19.png)
When input becomes VDD, the output voltage is pulled up by the Miller cap(red).

**How to optimize an inverter‘s delay?**

##### Inverter Chain
![](image_94.jpeg)

For single inverter, we assume that the equivalent resistance of pull-down and pull-up is equal.
![](image_95.jpeg)
The gate capacity of next level is $C_{ext}$ of this level.
![](image_96.jpeg)

**Why is no Miller effect?**
##### Factor $\gamma$  and f
Consider input/loading effect of one inverter:
$$
t_p=t_{p0}(1+\frac{C_{ext}}{C_{int}})=t_{p0}(1+\frac{C_{ext}}{\gamma C_g})=t_{p0}(1+\frac{f}{\gamma})
$$
$$
\gamma = \frac{C_{int}}{C_g}\qquad f=\frac{C_{ext}}{C_g}
$$
For whole inverter chain
![](image_97.jpeg)
$$
t_{p}=t_{p0}\Sigma (1+\frac{C_{g,j}}{\gamma C_{g,j}})\quad C_{g,N+1}=C_L
$$
**How to find the best f and N**
Because $\prod f=C$, if we want to minimize $t_p$, we need to make $f_1=f_2=\cdots=f_N$. So there is 
$$
\begin{align}
C_{g,j}=\sqrt{C_{g,j-1}\cdot C_{g,j+1}}\\
f=\sqrt[N]{C_L/C_{g,1}}=\sqrt[N] F\\
t_p=Nt_{p0}(1+\sqrt[N] F/\gamma)
\end{align}
$$
- If N too large, intrinsic delay of the stages becomes dominate.
- If N too small, effective fan-out of each stage becomes dominate.
$$
\frac{\partial t_p}{\partial N}=0
$$
$$
\Downarrow
$$
$$
\gamma +\sqrt[N] F-\frac{\sqrt[N]FlnF}{N}=0
$$
$$
f*=\sqrt[N] F=e^{(1+N/\gamma)}
$$
$$
\begin{cases}
f=e,\quad \gamma = 0\\
f=3.6,\quad \gamma = 1
\end{cases}
$$

### Dynamic Power
##### Dynamic Energy Dissipation
![](image_98.jpeg)
$$
\begin{align}
E=\int^\infty_{t=0}V_{DD}\cdot I_{Dp}\cdot \mathrm dt\\
I_{Dp}=C_L\cdot \frac{\mathrm dV}{\mathrm dt}
\end{align}
$$
$$
E=C_L\cdot V^2_{DD}
$$
Dynamic energy is not a function of ==transistor size==.
$C_L$ is not only relevant for speed, but also energy. _That is the reason why we make transistor smaller and smaller_.
##### Not Full Swing
For inverter chain
$$
E_N=C_L\cdot V^2_{DD} \cdot n(N)\
$$
$$
\begin{align}
P_{avg}&=\lim_{N\rightarrow\infty}\frac{E_N}{N}\cdot f_{clk}\\
&=(\lim_{N\rightarrow\infty}\frac{n(N)}{N})\cdot C_L\cdot V^2_{DD}\cdot f_{clk}\\
&=\alpha_{0\rightarrow1}\cdot C_L\cdot V_{DD}^2\cdot f_{clk}

\end{align}
$$

High $V_{DD}$ brings high _energy consumption_ and _high frequency_.
##### Short-Circuit Power Comsumption

![](image_99.jpeg)

Consider impact of $C_L$ on $P_{dp}$

##### Leakage (static) Power Consumption
![[Leakage Current Mechanisms]]
![](_image/数字集成电路设计_image_3.png)
![](_image/数字集成电路设计_image_79.jpeg)

##### Power summery
![](_image/数字集成电路设计_image_80.jpeg)

##### PDP and EDP
Power-delay product
$$
PDP=C_LV^2_{DD}f_{max}t_p=\frac{C_LV^2_{DD}}{2}\qquad f_{max}=\frac{1}{2t_p}
$$
Energy-delay product
$$
EDP=PDP\times t_p=P_{av}t^2_p=\frac{C_LV_{DD}^2}{2}t_p
$$

# Lecture 4 Static Complementary CMOS Logic Gates

[[Static CMOS Logic]]
[[Dynamic CMOS Logic]]
[[Pass-Transistor Logic]]
[[Ratiod Logic and Ratioless Logic]]


## Static Complementary CMOS Gates
### NAND Gate
![](_image/数字集成电路设计_image_81.jpeg)

### NOR Gate 
![](_image/数字集成电路设计_image_82.jpeg)

- Use series to express AND or NAND
- Use Parallel to express OR and NOR

**Why PMOS for PUN, NMOS for PDN?**
- PMOS for PDN can’t reach GND
- NMOS for PUN can’t reach VDD

[[Delay in combinational networks]]

[[Pass Transistor(PT) Logic]]


# Lecture 5 Datapath Blocks
[[Adders]]
[[Multipliers]]
[[Multiplexers]]
[[Decoders]]
[[Comparators]]
[[Shifters]]


